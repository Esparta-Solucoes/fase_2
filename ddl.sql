-- Dimensões de Localização
CREATE TABLE DIM_REGIAO (
    ID_REGIAO       NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_REGIAO     VARCHAR2(20)    NOT NULL,
    CONSTRAINT PK_DIM_REGIAO PRIMARY KEY (ID_REGIAO)
);

CREATE TABLE DIM_ESTADO (
    ID_ESTADO       NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    SIGLA_ESTADO    CHAR(2)         NOT NULL,
    NOME_ESTADO     VARCHAR2(50)    NOT NULL,
    GENTILICO       VARCHAR2(50),
    ID_REGIAO       NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_ESTADO PRIMARY KEY (ID_ESTADO),
    CONSTRAINT FK_ESTADO_REGIAO FOREIGN KEY (ID_REGIAO) 
        REFERENCES DIM_REGIAO(ID_REGIAO)
);

CREATE TABLE DIM_CIDADE (
    ID_CIDADE       NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_CIDADE     VARCHAR2(100)   NOT NULL,
    NR_POPULACAO    NUMBER(10,0),
    CODIGO_IBGE     NUMBER(10,0),
    ALTITUDE        NUMBER(5,0),
    ID_ESTADO       NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_CIDADE PRIMARY KEY (ID_CIDADE),
    CONSTRAINT FK_CIDADE_ESTADO FOREIGN KEY (ID_ESTADO) 
        REFERENCES DIM_ESTADO(ID_ESTADO)
);

CREATE TABLE DIM_BAIRRO (
    ID_BAIRRO           NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_BAIRRO         VARCHAR2(100)   NOT NULL,
    NR_POPULACAO_BAIRRO NUMBER(9,0),
    NR_NIVEL_SEGURANCA  NUMBER(1,0),
    ID_CIDADE           NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_BAIRRO PRIMARY KEY (ID_BAIRRO),
    CONSTRAINT FK_BAIRRO_CIDADE FOREIGN KEY (ID_CIDADE) 
        REFERENCES DIM_CIDADE(ID_CIDADE)
);

-- Dimensões de Produto
CREATE TABLE DIM_CATEGORIA (
    ID_CATEGORIA            NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_CATEGORIA          VARCHAR2(100)   NOT NULL,
    ST_CATEGORIA            CHAR(1)         NOT NULL,
    NR_AVALIACAO_CATEGORIA  NUMBER(3,1),
    CONSTRAINT PK_DIM_CATEGORIA PRIMARY KEY (ID_CATEGORIA)
);

CREATE TABLE DIM_SUBCATEGORIA (
    ID_SUBCATEGORIA                NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_SUBCATEGORIA              VARCHAR2(100)   NOT NULL,
    ST_SUB_CATEGORIA               CHAR(1)         NOT NULL,
    NR_AVALIACAO_SUB_CATEGORIA     NUMBER(3,1),
    ID_CATEGORIA                   NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_SUBCATEGORIA PRIMARY KEY (ID_SUBCATEGORIA),
    CONSTRAINT FK_SUBCATEGORIA_CATEGORIA FOREIGN KEY (ID_CATEGORIA) 
        REFERENCES DIM_CATEGORIA(ID_CATEGORIA)
);

CREATE TABLE DIM_PRODUTO (
    ID_PRODUTO      NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_PRODUTO    VARCHAR2(150)   NOT NULL,
    EMBALAGEM       VARCHAR2(50),
    ID_SUBCATEGORIA NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_PRODUTO PRIMARY KEY (ID_PRODUTO),
    CONSTRAINT FK_PRODUTO_SUBCATEGORIA FOREIGN KEY (ID_SUBCATEGORIA) 
        REFERENCES DIM_SUBCATEGORIA(ID_SUBCATEGORIA)
);

-- Demais dimensões
CREATE TABLE DIM_CLIENTE (
    ID_CLIENTE      NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NR_CLIENTE      NUMBER          NOT NULL,
    NOME_CLIENTE    VARCHAR2(100)   NOT NULL,
    NR_ESTRELAS     NUMBER(1,0),
    ST_CLIENTE      CHAR(1),
    DT_NASCIMENTO   DATE,
    NOME_LOGRADOURO VARCHAR2(100),
    NR_LOGRADOURO   VARCHAR2(10),
    NR_CEP          VARCHAR2(15),
    ID_BAIRRO       NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_CLIENTE PRIMARY KEY (ID_CLIENTE),
    CONSTRAINT FK_CLIENTE_BAIRRO FOREIGN KEY (ID_BAIRRO) 
        REFERENCES DIM_BAIRRO(ID_BAIRRO)
);

CREATE TABLE DIM_CENTRO_DISTRIBUICAO (
    ID_CENTRO_DIST          NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CD_CD                   NUMBER          NOT NULL,
    NOME_CENTRO_DISTRIBUICAO VARCHAR2(100)  NOT NULL,
    ID_BAIRRO               NUMBER          NOT NULL,
    CONSTRAINT PK_DIM_CENTRODIST PRIMARY KEY (ID_CENTRO_DIST),
    CONSTRAINT FK_CENTRODIST_BAIRRO FOREIGN KEY (ID_BAIRRO) 
        REFERENCES DIM_BAIRRO(ID_BAIRRO)
);

CREATE TABLE DIM_ENTREGADOR (
    ID_ENTREGADOR   NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME_ENTREGADOR VARCHAR2(100)   NOT NULL,
    CONSTRAINT PK_DIM_ENTREGADOR PRIMARY KEY (ID_ENTREGADOR)
);

CREATE TABLE DIM_DATA (
    ID_DATA         NUMBER          GENERATED BY DEFAULT ON NULL AS IDENTITY,
    DATA_COMPLETA   DATE            NOT NULL,
    ANO             NUMBER(4,0)     NOT NULL,
    MES             NUMBER(2,0)     NOT NULL,
    NOME_MES        VARCHAR2(20),
    DIA             NUMBER(2,0)     NOT NULL,
    NOME_DIA_SEMANA VARCHAR2(20),
    CONSTRAINT PK_DIM_DATA PRIMARY KEY (ID_DATA)
);

-- Tabela Fato
CREATE TABLE FATO_ENTREGA (
    NR_PEDIDO           NUMBER      NOT NULL,
    NR_ITEM             NUMBER      NOT NULL,
    ID_CLIENTE          NUMBER      NOT NULL,
    ID_PRODUTO          NUMBER      NOT NULL,
    ID_CENTRO_DIST      NUMBER      NOT NULL,
    ID_ENTREGADOR       NUMBER,
    ID_DATA_PEDIDO      NUMBER      NOT NULL,
    ID_DATA_PREVISTA    NUMBER      NOT NULL,
    ID_DATA_ENTREGA     NUMBER      NOT NULL,
    QUANTIDADE          NUMBER(10,0) NOT NULL,
    QT_PROD_ENTREGUE    NUMBER(10,0) NOT NULL,
    VL_UNITARIO         NUMBER(12,2) NOT NULL,
    VL_TOTAL            NUMBER(12,2) NOT NULL,
    PERC_ICMS           NUMBER(5,2),
    NOTA_EMBALAGEM      NUMBER(2,0),
    NOTA_PONTUALIDADE   NUMBER(2,0),
    NOTA_CORTESIA       NUMBER(2,0),
    TEMPO_ENTREGA_MIN   NUMBER(10,0),
    CONSTRAINT PK_FATO_ENTREGA PRIMARY KEY (NR_PEDIDO, NR_ITEM),
    CONSTRAINT FK_FATO_CLIENTE FOREIGN KEY (ID_CLIENTE) 
        REFERENCES DIM_CLIENTE(ID_CLIENTE),
    CONSTRAINT FK_FATO_PRODUTO FOREIGN KEY (ID_PRODUTO) 
        REFERENCES DIM_PRODUTO(ID_PRODUTO),
    CONSTRAINT FK_FATO_CENTRO FOREIGN KEY (ID_CENTRO_DIST) 
        REFERENCES DIM_CENTRO_DISTRIBUICAO(ID_CENTRO_DIST),
    CONSTRAINT FK_FATO_ENTREGADOR FOREIGN KEY (ID_ENTREGADOR) 
        REFERENCES DIM_ENTREGADOR(ID_ENTREGADOR),
    CONSTRAINT FK_FATO_DATA_PED FOREIGN KEY (ID_DATA_PEDIDO) 
        REFERENCES DIM_DATA(ID_DATA),
    CONSTRAINT FK_FATO_DATA_PREV FOREIGN KEY (ID_DATA_PREVISTA) 
        REFERENCES DIM_DATA(ID_DATA),
    CONSTRAINT FK_FATO_DATA_ENT FOREIGN KEY (ID_DATA_ENTREGA) 
        REFERENCES DIM_DATA(ID_DATA)
);